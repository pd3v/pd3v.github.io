<!DOCTYPE html>
<html>
<head>
  <style>
  html, body {
    width:  100%;
    height: 100%;
    margin: 0px;
  }
  </style>
  <title>pd3v sounding code</title>
  <meta charset="UTF-8">
<body>
  <canvas id="textCanvas" height = 50></canvas>
  <canvas id="colorCanvas"></canvas>
  <!-- <div id="onOffBtt" width="100" height="100">AAA</div> -->
</body>
<script>

// Page layout
var cTitle = document.getElementById("textCanvas");
var ctxTitle = cTitle.getContext("2d");
ctxTitle.canvas.width  = window.innerWidth;
ctxTitle.font = "30px Verdana";
ctxTitle.fillText("fluX 0.01 sounding",10,40);

var c = document.getElementById("colorCanvas");
var ctx = c.getContext("2d");
ctx.canvas.width  = window.innerWidth;
ctx.canvas.height = window.innerHeight;

//Create gradient
var grd = ctx.createLinearGradient(0,0,ctx.canvas.width,0);
grd.addColorStop(0,"#00ffa0");
grd.addColorStop(1,"blue");

// Fill with gradient
ctx.fillStyle = grd;
ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);

// Sound objects
var ac = new AudioContext();
var osc1 = ac.createOscillator();
var osc2 = ac.createOscillator();
var gainNode = ac.createGain();

var detune = 0.0;
var incDec = 1;

osc1.connect(gainNode);
osc1.type = 'saw';
osc1.frequency.value = 220;

osc2.connect(gainNode);
osc2.type = 'triangle';
osc2.frequency.value = 220;

gainNode.connect(ac.destination);
gainNode.gain.value = 0.99;

osc1.start();
osc2.start();

document.onload = vectorSynthesis(100);

function vectorSynthesis(e){
  if (detune > 3.0) {
    incDec = -1;
  } else if (detune < -3.0){
    incDec = 1;
  }
  
  detune += 1.0 * incDec;
  osc1.frequency.value -= detune;
  osc2.frequency.value += detune;
  
  setTimeout(vectorSynthesis, 100*Math.random()*Math.log(Math.random()*30));
}
</script>
</html>
