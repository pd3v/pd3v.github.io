<!DOCTYPE html>
<html>
<head>
  <style>
  body {
    width:  100%;
    height: 100%;
    margin: 0px;
  }
  a {
    color: #ffffff7a;
    opacity: 0.8;
    padding: 2px;
    text-decoration: none;
  }
  a:hover {
    color: black;
    padding: 2px;
    background-color: white;
    opacity: 0.3;
  }
  a:visited {
    text-decoration: none;
  }
  #top_bar {
    margin: 0px;
  }
  #gen_algorithm {
    overflow-y: auto;
    width: 35%;
    margin: 5px;
    padding: 5px;
    font-family: "menlo", sans-serif;
    float: right;
    z-index: -2;
  }
  #code {
    color: #ffffff7a;
    font-size: 15px;
  }
  #code span {
    color: #ffffff4a;
    font-size: 12px;
  }
  #title {
    font-family: "menlo", sans-serif;
    font-size: 40px;
    color: cyan;
    float: left;
  }
  #version {
    height: 40px;
    font-family: "verdana", sans-serif;
    font-size: 14px;
    color: cyan;
    line-height: 65px;
    margin-left: 5px;
    float: left;
  }
  #subtitle {
    font-family: "menlo", sans-serif;
    font-size: 30px;
    color: #777777;
    margin-left: 15px;
    line-height: 60px;
    float: left;
  }
  #repo {
    font-family: "menlo", sans-serif;
    font-size: 15px;
    font-style: italic;
    color: #ffffff7a;
    opacity: 0.8;
    padding: 2px;
    margin-left: 50px;
    line-height: 62px;
    float: left;
  }
  canvas {
    position: absolute;
    z-index: -1;
  }
  </style>
  <title>pd3v sounding code</title>
  <meta charset="UTF-8">
</head>
<body>
  <script type="text/javascript" src="midiout.js"></script>
  <script type="text/javascript" src="synth.js"></script>
  <script type="text/javascript" src="generator.js"></script>
  <script type="text/javascript" src="sequencer.js"></script>
  <script type="text/javascript" src="helpers.js"></script>
  <canvas id="colorCanvas"></canvas>
  <div id="top_bar">
    <div id="title">fluX</div>
    <div id="version">0.0.1</div>
    <div id="subtitle">sounding</div>
  </div>
  <div id="repo"><a href="https://github.com/pd3v/fluX" target="_blank">go to repo</a></div>
  <div id="gen_algorithm">
    <div id="code">gen algorithm::</div>
  </div>
</body>
<script>
const NUMBER_OF_ALGORITHMS = 6;

var GenerativeAlgorithm = {
  load: function(src, callback) {
    var script = document.createElement('script'),loaded;
    script.setAttribute('src', src);
    if (callback) {
      script.onreadystatechange = script.onload = function() {
        if (!loaded) {
          callback();
        }
        loaded = true;
      };
    }
    document.head.appendChild(script);
  }
}

GenerativeAlgorithm.load('genalgorithms/gen' + ((NUMBER_OF_ALGORITHMS-1)*Math.random()+1).toFixed(0) + '.js', function() {
  document.getElementById("code").innerHTML += '<span>'+f+'</span>';
});

// Page layout
var canvas = document.getElementById("colorCanvas");
var ctx = canvas.getContext("2d");
ctx.canvas.width  = window.innerWidth;
ctx.canvas.height = window.innerHeight;

var AudioContext = window.AudioContext || window.webkitAudioContext;
var ac = new AudioContext();

var scope = ac.createAnalyser();
var bufferLength = scope.frequencyBinCount;
var dataArray = new Uint8Array(bufferLength);
var fps = 20;

scope.fftSize = 2048;
scope.getByteTimeDomainData(dataArray);

drawWave();

function drawWave() {
  var sliceWidth = ctx.canvas.width * 1.1 / bufferLength;
  var x = 0;

  scope.getByteTimeDomainData(dataArray);

  ctx.lineWidth = 0.5;
  ctx.strokeStyle = '#999999';
  ctx.stroke();

  setTimeout(function() {
       requestAnimationFrame(drawWave);

       ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
       ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
       ctx.beginPath();

       for(var i = 0; i < bufferLength; i++) {
         var v = dataArray[i] / 128.0;
         var y = v * ctx.canvas.height/2;

         if(i === 0) {
           ctx.moveTo(x, y);
         } else {
           ctx.lineTo(x, y);
         }
         x += sliceWidth;
       }
   }, 1000 / fps);

  ctx.lineTo(ctx.canvas.width, ctx.canvas.height);
  ctx.stroke();
};
</script>
</html>
